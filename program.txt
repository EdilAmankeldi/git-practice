
var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();

// –•—Ä–∞–Ω–∏–ª–∏—â–µ –∫–Ω–∏–≥ –≤ –ø–∞–º—è—Ç–∏
var books = new List<Book>
{
    new Book { Id = 1, Title = "–ú–∞—Å—Ç–µ—Ä –∏ –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞", Author = "–ú. –ë—É–ª–≥–∞–∫–æ–≤", Year = 1967 },
    new Book { Id = 2, Title = "–ü—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –∏ –Ω–∞–∫–∞–∑–∞–Ω–∏–µ", Author = "–§. –î–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π", Year = 1866 }
};
var nextId = 3;

app.MapGet("/", () => "Hello world");

// üîπ –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–Ω–∏–≥–∏
app.MapGet("/books", () => books);

// üîπ –ü–æ–ª—É—á–∏—Ç—å –∫–Ω–∏–≥—É –ø–æ ID
app.MapGet("/books/{id:int}", (int id) =>
{
    var book = books.FirstOrDefault(b => b.Id == id);
    return book is not null ? Results.Ok(book) : Results.NotFound();
});

// üîπ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–Ω–∏–≥—É
app.MapPost("/books", (Book newBook) =>
{
    newBook.Id = nextId++;
    books.Add(newBook);
    return Results.Created($"/books/{newBook.Id}", newBook);
});

// üîπ –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–∏–≥—É –ø–æ ID
app.MapPut("/books/{id:int}", (int id, Book updatedBook) =>
{
    var book = books.FirstOrDefault(b => b.Id == id);
    if (book is null)
        return Results.NotFound();

    book.Title = updatedBook.Title;
    book.Author = updatedBook.Author;
    book.Year = updatedBook.Year;
    return Results.Ok(book);
});

// üîπ –£–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É
app.MapDelete("/books/{id:int}", (int id) =>
{
    var book = books.FirstOrDefault(b => b.Id == id);
    if (book is null)
        return Results.NotFound();

    books.Remove(book);
    return Results.NoContent();
});

app.Run();

// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
public class Book
{
    public int Id { get; set; }
    public string Title { get; set; } = "";
    public string Author { get; set; } = "";
    public int Year { get; set; }
}
